#!/bin/sh
# bin/compile <build-dir> <cache-dir> <env-dir>

indent() {
  sed -u 's/^/       /'
}

# absolute path
BP_DIR=$(cd $(dirname $0)/..; pwd)
BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

echo $BUILD_DIR
echo $CACHE_DIR
echo $ENV_DIR

source $BP_DIR/lib/common.sh
source $BP_DIR/lib/maven.sh

export_env $ENV_DIR "." "JAVA_OPTS|JAVA_TOOL_OPTIONS"

install_jdk ${BUILD_DIR}
run_mvn "compile" $BUILD_DIR $CACHE_DIR

if has_maven_wrapper $BUILD_DIR; then
  cache_copy ".m2/wrapper" $BUILD_DIR $CACHE_DIR
  rm -rf $BUILD_DIR/.m2
fi
